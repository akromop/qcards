<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>QCards</title>

  <!-- üîµ –í–ê–ñ–ù–û: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π viewport –¥–ª—è iPhone, —á—Ç–æ–±—ã —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª–æ—Å—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <!-- üîµ iOS: –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ "–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", –±–µ–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="QCards">

  <!-- üîµ –ò–∫–æ–Ω–∫–∞ –¥–ª—è —è—Ä–ª—ã–∫–∞ (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –ø—É—Ç—å –Ω–∞ —Å–≤–æ–π —Ñ–∞–π–ª 180√ó180 PNG) -->
  <link rel="apple-touch-icon" href="icon-180.png">

  <style>
    :root {
      /* üü¢ –¶–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
      --bg-body: #050814;
      --bg-card: #0b0f1f;

      /* üü¢ –ê–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
      --accent-pink: #ff4fbf;
      --accent-pink-hover: #ff6fd0;
      --accent-lilac: #b388ff;
      --accent-lilac-hover: #9b6cff;

      /* üü¢ –¶–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –±–æ—Ä–¥–µ—Ä–æ–≤ */
      --border-soft: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      /* —Å–µ—Ä—ã–π —Å–¥–µ–ª–∞–ª —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ */
      --text-subtle: rgba(255, 255, 255, 0.6);

      /* üü¢ –¢—ë–º–Ω–∞—è ¬´–ø—Ä–∏–∑—Ä–∞—á–Ω–∞—è¬ª –∫–Ω–æ–ø–∫–∞ */
      --btn-dark: #141827;
      --btn-dark-hover: #1a1f33;

      /* üü¢ –°–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ —Ç–µ–Ω—å */
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 999px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
    }

    .app {
      /* —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
      width: 100%;
      max-width: 100%;
      min-height: 100vh;
      margin: 0;
      padding: 40px 12px 40px;    /* üü¢ –æ–±—â–∏–µ –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ ¬´–∫–∞—Ä—Ç–æ—á–∫–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è¬ª */
      border-radius: 0;
      background:
        radial-gradient(circle at top left, rgba(255, 79, 191, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(179, 136, 255, 0.16), transparent 55%),
        var(--bg-card);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-soft);

      display: flex;
      flex-direction: column;
    }

    header {
      text-align: center;         /* üü¢ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      margin-bottom: 20px;        /* üü¢ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —à–∞–ø–∫–∏ –¥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    }

    header h1 {
      font-size: 30px;            /* üü¢ —Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
      margin: 0;
      letter-spacing: 0.02em;
    }

    header p {
      margin: 20px 0 0;           /* üü¢ ¬´–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞¬ª –º–µ–∂–¥—É h1 –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–º */
      font-size: 20px;            /* üü¢ —Ä–∞–∑–º–µ—Ä –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞ */
      color: var(--text-subtle);
    }

    /* –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—ç–∫—Ä–∞–Ω—ã) –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞–¥ —Ñ—É—Ç–µ—Ä–æ–º */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .screen {
      display: none;
      /* –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞, —á—Ç–æ–±—ã home/card –Ω–µ –ø—Ä—ã–≥–∞–ª–∏ –º–µ–∂–¥—É —Å–æ–±–æ–π */
      min-height: 250px;          /* üü† –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤—ã—Å–æ—Ç—É ¬´—Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã¬ª */
    }
    .screen.active {
      display: block;
    }

    /* –ö–ù–û–ü–ö–ò –í–´–ë–û–†–ê –†–ï–ñ–ò–ú–ê */
    .mode-buttons {
      display: flex;
      flex-direction: column;
      gap: 18px;                  /* üü¢ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –±–æ–ª—å—à–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ */
      margin: 10px 0 10px;        /* üü¢ –æ—Ç—Å—Ç—É–ø—ã —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É –±–ª–æ–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ */
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      padding: 40px 20px;         /* üü¢ –≤—ã—Å–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
      font-size: 30px;            /* üü¢ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö */
      font-weight: 600;
      border-radius: var(--radius-md);
      border: none;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: transform 0.06s ease, box-shadow 0.06s ease,
        background-color 0.08s ease, opacity 0.08s ease;
      will-change: transform;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: var(--accent-pink);
      color: #250815;
      box-shadow: 0 8px 20px rgba(255, 79, 191, 0.4);
    }

    .btn-primary:hover {
      background: var(--accent-pink-hover);
    }

    .btn-secondary {
      background: var(--accent-lilac);
      color: #1b1030;
      box-shadow: 0 8px 18px rgba(179, 136, 255, 0.45);
    }

    .btn-secondary:hover {
      background: var(--accent-lilac-hover);
    }

    .btn-ghost {
      padding: 6px 14px;
      font-size: 14px;
      border-radius: var(--radius-sm);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-subtle);
      border: 1px solid rgba(255, 255, 255, 0.08);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.07);
    }

    .btn-ghost.small-reset {
      padding: 10px 20px;         /* üü¢ —Ä–∞–∑–º–µ—Ä –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫ –≤ —Ñ—É—Ç–µ—Ä–µ */
      font-size: 18px;            /* —à—Ä–∏—Ñ—Ç –∫–∞–∫ —É Kort i dag */
    }

    .btn-ghost:disabled {
      opacity: 0.45;              /* üü¢ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ disabled */
      cursor: default;
    }

    .small-label {
      font-size: 18px;
      color: var(--text-subtle);
    }

    /* –ö–ê–†–¢–û–ß–ö–ê */
    .card {
      padding: 15px 15px 15px;
      border-radius: var(--radius-md);
      background: rgba(6, 9, 22, 0.9);
      border: 3px solid var(--border-soft);
      transition: border-color 0.08s ease, box-shadow 0.08s ease;
    }

    /* –†–∞–º–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏ */
    .card.card-from-spm {
      border-color: var(--accent-pink);
      box-shadow: 0 0 0 1px rgba(255, 79, 191, 0.35);
    }
    .card.card-from-overraskelse {
      border-color: var(--accent-lilac);
      box-shadow: 0 0 0 1px rgba(179, 136, 255, 0.35);
    }

    .card-type {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--text-subtle);
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .card-text {
      font-size: 30px;            /* üü¢ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
      line-height: 1.55;
      margin-bottom: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
      min-height: 325px;          /* üü† –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
    }

    /* –ö–Ω–æ–ø–∫–∞ ¬´Tilbake¬ª ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ –ø–æ–¥ –∫–∞—Ä—Ç–æ—á–∫–æ–π, –ø–æ —Ü–µ–Ω—Ç—Ä—É –∏ —è—Ä–∫–∞—è */
    .card-actions {
      width: 50%;
      margin: 18px auto 0;
      display: flex;
      justify-content: center;
    }

    .btn-back {
      min-width: 100px;
      padding-inline: 10px;
      font-size: 30px;
      font-weight: 600;
      background: #2a3147;
      color: #1b1030;
      box-shadow: 0 8px 18px rgba(179, 136, 255, 0.45);
      border-radius: var(--radius-md);
    }
    .btn-back:hover {
      background: #343c56;
    }

    /* –û–ë–©–ò–ô –§–£–¢–ï–†: Fjern + Kort i dag + Nullstill */
    .bottom-row {
      margin-top: 50px;          /* üü† —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–æ —Ñ—É—Ç–µ—Ä–∞ */
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      color: var(--text-subtle);
    }

    .bottom-row-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .bottom-row span strong {
      color: var(--text-main);
      font-weight: 600;
    }

    @media (min-width: 900px) {
      /* —á—Ç–æ–±—ã –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º —Ä–∞—Å—Ç—è–Ω—É—Ç–æ */
      .app {
        width: 520px;
        margin: 24px auto;
        border-radius: var(--radius-lg);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>QCards</h1>
      <!-- üü¢ —Ç–µ–∫—Å—Ç –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –¥–ª—è –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤ -->
      <p id="header-sub">Klar for prat eller bare litt fun? Trykk p√• en knapp.</p>
    </header>

    <div class="content">
      <!-- –≠–∫—Ä–∞–Ω —Å –¥–≤—É–º—è –∫–Ω–æ–ø–∫–∞–º–∏ -->
      <main class="screen active" id="screen-home">
        <div class="mode-buttons">
          <button id="btn-spm" class="btn btn-primary">
            Sp√∏rsm√•l
          </button>
          <button id="btn-overraskelse" class="btn btn-secondary">
            Overraskelse
          </button>
        </div>
      </main>

      <!-- –≠–∫—Ä–∞–Ω —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π -->
      <main class="screen" id="screen-card">
        <div class="card" id="card-container">
          <div class="card-type">
            <span id="card-type-pill">‚Äì</span>
          </div>
          <div class="card-text" id="card-text">
            Laster kort ‚Ä¶
          </div>
        </div>
        <div class="card-actions">
          <button id="btn-back" class="btn btn-back">
            ‚Üê Tilbake
          </button>
        </div>
      </main>
    </div>

    <!-- –û–±—â–∏–π —Ñ—É—Ç–µ—Ä: Fjern + Kort i dag + Nullstill -->
    <div class="bottom-row">
      <div class="bottom-row-left">
        <button id="btn-remove" class="btn-ghost small-reset" type="button" disabled>
          Fjern
        </button>
      </div>
      <div class="bottom-row-right">
        <span class="small-label">
          Kort i dag: <strong id="stats-count">‚Äì</strong>
        </span>
        <button id="btn-reset" class="btn-ghost small-reset" type="button">
          Nullstill
        </button>
      </div>
    </div>
  </div>

  <script>
    // üü¢ –í–°–¢–ê–í–¨ –°–í–û–ô WEB APP URL –ù–ò–ñ–ï
    const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbxG4qwvJAu51QRaQgu9FvKnMb5Wi2NMHQK8mnSsRsFlogSElriOFXZ96uOuGwGF6yQ0qg/exec';

    const screenHome = document.getElementById('screen-home');
    const screenCard = document.getElementById('screen-card');

    const btnSpm = document.getElementById('btn-spm');
    const btnOverraskelse = document.getElementById('btn-overraskelse');
    const btnBack = document.getElementById('btn-back');
    const btnReset = document.getElementById('btn-reset');
    const btnRemove = document.getElementById('btn-remove');

    const cardContainer = document.getElementById('card-container');
    const cardTypePill = document.getElementById('card-type-pill');
    const cardText = document.getElementById('card-text');
    const statsCountEl = document.getElementById('stats-count');
    const headerSub = document.getElementById('header-sub');

    // –¢–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è Fjern
    let currentCard = null;

    function setScreen(name) {
      if (name === 'home') {
        screenHome.classList.add('active');
        screenCard.classList.remove('active');
        headerSub.style.display = 'block';

        currentCard = null;
        btnRemove.disabled = true;
      } else if (name === 'card') {
        screenCard.classList.add('active');
        screenHome.classList.remove('active');
        headerSub.style.display = 'none';
      }
    }

    async function callBackend(params) {
      const url = new URL(BACKEND_URL);
      if (params) {
        Object.keys(params).forEach(key => {
          url.searchParams.set(key, params[key]);
        });
      }

      const res = await fetch(url.toString(), { cache: 'no-store' });
      if (!res.ok) {
        throw new Error('HTTP ' + res.status);
      }
      return res.json();
    }

    function setCardVisualMode(mode) {
      cardContainer.classList.remove('card-from-spm', 'card-from-overraskelse');
      if (mode === 'spm') {
        cardContainer.classList.add('card-from-spm');
      } else if (mode === 'overraskelse') {
        cardContainer.classList.add('card-from-overraskelse');
      }
    }

    async function loadCard(mode) {
      try {
        cardText.textContent = 'Laster kort ‚Ä¶';
        setCardVisualMode(mode);
        setScreen('card');

        const data = await callBackend({ mode });

        if (!data.ok) {
          cardTypePill.textContent = 'Feil';
          cardText.textContent = data.error || 'Ukjent feil';
          currentCard = null;
          btnRemove.disabled = true;
          return;
        }

        cardTypePill.textContent = data.type || '‚Äì';
        cardText.textContent = data.text || '';

        currentCard = {
          type: data.type,
          id: data.id
        };
        btnRemove.disabled = false;

        updateStats();
      } catch (err) {
        cardTypePill.textContent = 'Feil';
        cardText.textContent = 'Kunne ikke hente kort. Pr√∏v igjen.';
        console.log(err);
        currentCard = null;
        btnRemove.disabled = true;
      }
    }

    async function updateStats() {
      try {
        const data = await callBackend({ mode: 'stats' });
        if (data.ok && typeof data.count === 'number') {
          statsCountEl.textContent = data.count;
        }
      } catch (err) {
        console.log('stats error', err);
      }
    }

    async function resetToday() {
      try {
        const prevText = btnReset.textContent;
        btnReset.textContent = '...';
        btnReset.disabled = true;

        await callBackend({ mode: 'reset' });
        await updateStats();
      } catch (err) {
        console.log('reset error', err);
      } finally {
        btnReset.textContent = 'Nullstill';
        btnReset.disabled = false;
      }
    }

    async function removeCurrentCard() {
      try {
        if (!currentCard || !currentCard.type || currentCard.id === undefined || currentCard.id === null) {
          return;
        }

        const prevText = btnRemove.textContent;
        btnRemove.textContent = '...';
        btnRemove.disabled = true;

        await callBackend({
          mode: 'remove',
          type: currentCard.type,
          id: String(currentCard.id)
        });

        currentCard = null;
      } catch (err) {
        console.log('remove error', err);
      } finally {
        btnRemove.textContent = 'Fjern';
        btnRemove.disabled = true;
      }
    }

    btnSpm.addEventListener('click', () => loadCard('spm'));
    btnOverraskelse.addEventListener('click', () => loadCard('overraskelse'));
    btnBack.addEventListener('click', () => setScreen('home'));
    btnReset.addEventListener('click', resetToday);
    btnRemove.addEventListener('click', removeCurrentCard);

    setScreen('home');
    updateStats();
  </script>
</body>
</html>
